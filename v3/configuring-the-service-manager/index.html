<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="laminas-servicemanager: factory-driven dependency injection container"> 

    
    
        
    
    <meta name="docsearch:version" content="4.0.0,latest">
    <meta name="docsearch:language" content="en">
    <meta name="docsearch:component" content="laminas-servicemanager">

    <link rel="canonical" href="https://docs.laminas.dev/laminas-servicemanager/v3/configuring-the-service-manager/">
    <link rel="shortcut icon" href="https://docs.laminas.dev/img/trademark-laminas-foundation-rgb.svg">

    <title>Configuring the service manager - laminas-servicemanager - Laminas Docs</title>

    <link rel="stylesheet" href="https://docs.laminas.dev/css/styles.css">
    
</head>
<body id="page-top" class="components" data-spy="scroll" data-target=".toc" data-offset="20">

    
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        
        <a class="logo-link navbar-brand" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">

            
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown sub-project-selector">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a href="https://docs.mezzio.dev/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mezzio-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Mezzio</strong><br>
                                        PSR-15 Middleware in Minutes
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/components/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-components-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Components</strong><br>
                                        Components for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/mvc" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="https://docs.laminas.dev/img/laminas-mvc-rgb.svg">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>MVC</strong><br>
                                        MVC for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/migration/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Migration to Laminas
                                    </div>
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/tutorials/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Tutorials
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>

            
            
                <div class="d-block d-sm-none">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">laminas-servicemanager</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../quick-start/" class="subnavigation__link">Quick Start</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../psr-11/" class="subnavigation__link">PSR-11 Support</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Configuring the service manager</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../delegators/" class="subnavigation__link">Delegators</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../lazy-services/" class="subnavigation__link">Lazy services</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../plugin-managers/" class="subnavigation__link">Plugin managers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../config-abstract-factory/" class="subnavigation__link">Configuration-based Abstract Factory</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../reflection-abstract-factory/" class="subnavigation__link">Reflection-based Abstract Factory</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../console-tools/" class="subnavigation__link">Console Tools</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Cookbook</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../cookbook/factories-vs-abstract-factories/" class="subnavigation__link">Factories vs Abstract Factories</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../migration/" class="subnavigation__link">Migration Guide</a>
    </li>

                    
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="d-block d-sm-none">
                <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</nav>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-8">
                <h1 class="header__title">
                    Components

                    
                        <small class="header__subtitle">laminas-servicemanager</small>
                    
                </h1>
            </div>

            
            <div class="col-4 text-right">
                
                    
<div class="version-selector">
    <div class="btn-group">
        <button type="button" class="btn dropdown-toggle" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false" id="version-selector-dropdown">
            
                v3
            
        </button>
        <div class="dropdown-menu dropdown-menu-right dropdown-menu-lg-left" aria-labelledby="version-selector-dropdown">
            
                
                    <a href="../../v4/quick-start/" class="dropdown-item">
                        
                            v4 (latest)
                        
                    </a>
                
            
                
                    <a href="../quick-start/" class="dropdown-item active">
                        
                            v3
                        
                    </a>
                
            
        </div>
    </div>
</div>


                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/laminas/laminas-servicemanager" class="header__link header__link--github" title="Go to repository of laminas-servicemanager">
                        <i class="fab fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-sm-12 content" role="main">
                
                
                    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">On this page</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#factories" class="toc__link nav-link">Factories</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#abstract-factories" class="toc__link nav-link">Abstract factories</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#aliases" class="toc__link nav-link">Aliases</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#initializers" class="toc__link nav-link">Initializers</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#shared" class="toc__link nav-link">Shared</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#passing-config-to-a-factorydelegator" class="toc__link nav-link">Passing config to a factory/delegator</a>
                    </li>
                
                    <li class="toc__entry">
                        <a href="#altering-a-service-managers-config" class="toc__link nav-link">Altering a service manager's config</a>
                    </li>
                
            </ul>
        </div>
    

                

                
                    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/">Overview</a></li>
            <li class="breadcrumb-item"><a href="https://docs.laminas.dev/components/">Components</a></li>

            
                <li class="breadcrumb-item"><a href="../..">laminas-servicemanager</a></li>

                
                    
                        
                        
                    
                
                    
                        
                        
                            <li class="breadcrumb-item">Reference</li>
                        
                    
                

                <li class="breadcrumb-item active" aria-current="page">Configuring the service manager</li>
            
        
    </ol>
</nav>



    <div class="alert alert-danger" role="alert">
        <h4>Caution</h4>
        <p>
            The documentation you are viewing is for an older version of this component.<br>
            <a href="../..">Switch to the latest (v4) version.</a>
        </p>
    </div>




    
    
        <h2 class="chapter__headline">Reference</h2>
    

    <h1 id="configuring-the-service-manager">Configuring the service manager</h1>
<p>The Service Manager component can be configured by passing an associative array to the component's
constructor. The following keys are:</p>
<ul>
<li><code>services</code>: associative array that maps a key to a service instance.</li>
<li><code>invokables</code>: an associative array that maps a key to a constructor-less service;
  i.e., for services that do not require arguments to the constructor. The key and
  service name usually are the same; if they are not, the key is treated as an alias.</li>
<li><code>factories</code>: associative array that map a key to a factory name, or any callable.</li>
<li><code>abstract_factories</code>: a list of abstract factories classes. An abstract
  factory is a factory that can potentially create any object, based on some
  criterias.</li>
<li><code>delegators</code>: an associative array that maps service keys to lists of delegator factory keys, see the <a href="../delegators/">delegators documentation</a> for more details.</li>
<li><code>aliases</code>: associative array that map a key to a service key (or another alias).</li>
<li><code>initializers</code>: a list of callable or initializers that are run whenever a service has been created.</li>
<li><code>lazy_services</code>: configuration for the lazy service proxy manager, and a class
  map of service:class pairs that will act as lazy services; see the
  <a href="../lazy-services/">lazy services documentation</a> for more details.</li>
<li><code>shared</code>: associative array that maps a service name to a boolean, in order to
  indicate to the service manager whether or not it should cache services it
  creates via <code>get</code> method, independent of the <code>shared_by_default</code> setting.</li>
<li><code>shared_by_default</code>: boolean that indicates whether services created through
  the <code>get</code> method should be cached. This is <code>true</code> by default.</li>
</ul>
<p>Here is an example of how you could configure a service manager:</p>
<pre class="highlight"><code class="language-php">use Laminas\ServiceManager\ServiceManager;

$serviceManager = new ServiceManager([
    'services'           =&gt; [],
    'invokables'         =&gt; [],
    'factories'          =&gt; [],
    'abstract_factories' =&gt; [],
    'delegators'         =&gt; [],
    'aliases'            =&gt; [],
    'initializers'       =&gt; [],
    'lazy_services'      =&gt; [],
    'shared'             =&gt; [],
    'shared_by_default'  =&gt; true,
]);</code></pre>
<h2 id="factories">Factories</h2>
<p>A factory is any callable or any class that implements the interface
<code>Laminas\ServiceManager\Factory\FactoryInterface</code>.</p>
<p>Service manager components provide a default factory that can be used to create
objects that do not have any dependencies:</p>
<pre class="highlight"><code class="language-php">use Laminas\ServiceManager\Factory\InvokableFactory;
use Laminas\ServiceManager\ServiceManager;
use stdClass;

$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class,
        MyObject::class =&gt; MyObjectFactory::class,
    ],
]);</code></pre>
<blockquote>
<p>For invokable classes we recommend using <code>Laminas\ServiceManager\Factory\InvokableFactory</code>,
because ServiceManager will convert all <code>invokables</code> into <code>factories</code> using <code>InvokableFactory</code> internally.</p>
</blockquote>
<p>As said before, a factory can also be a callable, to create more complex objects:</p>
<pre class="highlight"><code class="language-php">use Interop\Container\ContainerInterface;
use Laminas\ServiceManager\Factory\InvokableFactory;
use Laminas\ServiceManager\ServiceManager;
use stdClass;

$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class,
        MyObject::class =&gt; function(ContainerInterface $container, $requestedName) {
            $dependency = $container-&gt;get(stdClass::class);
            return new MyObject($dependency);
        },
    ],
]);</code></pre>
<p>Each factory always receive a <code>ContainerInterface</code> argument (this is the base
interface that the <code>ServiceManager</code> implements), as well as the requested name
as the second argument. In this case, the <code>$requestedName</code> is <code>MyObject</code>.</p>
<p>Alternatively, the above code can be replaced by a factory class instead of a
closure. This leads to more readable code. For instance:</p>
<pre class="highlight"><code class="language-php">// In MyObjectFactory.php file

class MyObjectFactory implements FactoryInterface
{
    public function __invoke(ContainerInterface $container, $requestedName, array $options = null)
    {
        $dependency = $container-&gt;get(stdClass::class);
        return new MyObject($dependency);
    }
}

// or without implementing the interface:
class MyObjectFactory
{
    public function __invoke(ContainerInterface $container, $requestedName)
    {
        $dependency = $container-&gt;get(Dependency::class);
        return new MyObject($dependency);
    }
}

// When creating the service manager:
$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class,
        MyObject::class =&gt; MyObjectFactory::class
    ]
]);</code></pre>
<blockquote>
<p>For performance reasons, factories objects are not created until requested.
In the above example, this means that the <code>MyObjectFactory</code> object won't be
created until <code>MyObject</code> is requested.</p>
</blockquote>
<h3 id="mapping-multiple-service-to-the-same-factory">Mapping multiple service to the same factory</h3>
<p>Unlike version 2 implementations of the component, in the version 3
implementation, the <code>$requestedName</code> is guaranteed to be passed as the second
parameter of a factory. This is useful when you need to create multiple
services that are created exactly the same way, hence reducing the number of
needed factories.</p>
<p>For instance, if two services share the same creation pattern, you could attach the same factory:</p>
<pre class="highlight"><code class="language-php">// In MyObjectFactory.php file

class MyObjectFactory implements FactoryInterface
{
    public function __invoke(ContainerInterface $container, $requestedName, array $options = null)
    {
        $dependency = $container-&gt;get(stdClass::class);
        return new $requestedName($dependency);
    }
}

// or without implementing the interface:
class MyObjectFactory
{
    public function __invoke(ContainerInterface $container, $requestedName)
    {
        $dependency = $container-&gt;get(Dependency::class);
        return new $requestedName($dependency);
    }
}

// When creating the service manager:
$serviceManager = new ServiceManager([
    'factories' =&gt; [
        MyObjectA::class =&gt; MyObjectFactory::class,
        MyObjectB::class =&gt; MyObjectFactory::class
    ]
]);</code></pre>
<p>This pattern can often replace abstract factories, and is more performant:</p>
<ul>
<li>Lookups for services do not need to query abstract factories; the service is
  mapped explicitly.</li>
<li>Once the factory is loaded for any object, it stays in memory for any other
  service using the same factory.</li>
</ul>
<p>Using factories is recommended in most cases where abstract factories were used
in version 2.</p>
<p>This feature <em>can</em> be abused, however: for instance, if you have dozens of
services that share the same creation, but which do not share any common
functionality, we recommend to create separate factories.</p>
<h2 id="abstract-factories">Abstract factories</h2>
<p>An abstract factory is a specialized factory that can be used to create any
service, if it has the capability to do so. An abstract factory is often useful
when you do not know in advance the name of the service (e.g. if the service
name is generated dynamically at runtime), but know that the services share a
common creation pattern.</p>
<p>An abstract factory must be registered inside the service manager, and is
checked if no factory can create an object. Each abstract factory must
implement <code>Laminas\ServiceManager\Factory\AbstractFactoryInterface</code>:</p>
<pre class="highlight"><code class="language-php">// In MyAbstractFactory.php:

class MyAbstractFactory implements AbstractFactoryInterface
{
    public function canCreate(ContainerInterface $container, $requestedName)
    {
        return in_array('Traversable', class_implements($requestedName), true);
    }

    public function __invoke(ContainerInterface $container, $requestedName, array $options = null)
    {
        return $requestedName();
    }
}

// When creating the service manager:
$serviceManager = new ServiceManager([
    'abstract_factories' =&gt; [
        new MyAbstractFactory() // You could also pass a class name: MyAbstractFactory::class
    ]
]);

// When fetching an object:
$object = $serviceManager-&gt;get(A::class);</code></pre>
<p>Here is what will happen:</p>
<ol>
<li>The service manager will check if it contains a factory mapped to the
   <code>A::class</code> service.</li>
<li>Because none is found, it will process each abstract factory, in the order
   in which they were registered.</li>
<li>It will call the <code>canCreate()</code> method, passing the service manager instance and
   the name of the requested object. The method can use any logic whatsoever to
   determine if it can create the service (such as checking its name, checking
   for a required dependency in the passed container, checking if a class
   implements a given interface, etc.).</li>
<li>If <code>canCreate()</code> returns <code>true</code>, it will call the <code>__invoke</code> method to
   create the object. Otherwise, it will continue iterating the abstract
   factories, until one matches, or the queue is exhausted.</li>
</ol>
<h3 id="best-practices">Best practices</h3>
<p>While convenient, we recommend you to limit the number of abstract factories.
Because the service manager needs to iterate through all registered abstract
factories to resolve services, it can be costly when multiple abstract
factories are present.</p>
<p>Often, mapping the same factory to multiple services can solve the issue more
efficiently (as described in the <code>Factories</code> section).</p>
<h2 id="aliases">Aliases</h2>
<p>An <em>alias</em> provides an alternative name for a registered service.</p>
<p>An alias can also be mapped to another alias (it will be resolved recursively).
For instance:</p>
<pre class="highlight"><code class="language-php">use Laminas\ServiceManager\Factory\InvokableFactory;
use Laminas\ServiceManager\ServiceManager;
use stdClass;

$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class
    ],

    'aliases' =&gt; [
        'A' =&gt; stdClass::class,
        'B' =&gt; 'A'
    ]
]);

$object = $serviceManager-&gt;get('B');</code></pre>
<p>In this example, asking <code>B</code> will be resolved to <code>A</code>, which will be itself
resolved to <code>stdClass::class</code>, which will finally be constructed using the
provided factory.</p>
<h3 id="best-practices_1">Best practices</h3>
<p>We recommend you minimal use of aliases, and instead using the <code>::class</code>
language construct to map using a FQCN (Fully-Qualified-Class-Name). This
provides both better discoverability within your code, and allows simpler
refactoring, as most modern IDEs can refactor class names specified using the
<code>::class</code> keyword.</p>
<h2 id="initializers">Initializers</h2>
<p>An initializer is any callable or any class that implements the interface
<code>Laminas\ServiceManager\Initializer\InitializerInterface</code>. Initializers are
executed for each service the first time they are created, and can be used to
inject additional dependencies.</p>
<p>For instance, if we'd want to automatically inject the dependency
<code>EventManager::class</code> in all objects that implement the interface
<code>EventManagerAwareInterface</code>, we could create the following initializer:</p>
<pre class="highlight"><code class="language-php">use Interop\Container\ContainerInterface;
use stdClass;
use Laminas\ServiceManager\ServiceManager;

$serviceManager = new ServiceManager([
    'initializers' =&gt; [
        function(ContainerInterface $container, $instance) {
            if (! $instance instanceof EventManagerAwareInterface) {
                return;
            }
            $instance-&gt;setEventManager($container-&gt;get(EventManager::class));
        }
    ]
]);</code></pre>
<p>Alternately, you can create a class that implements
<code>Laminas\ServiceManager\Initializer\InitializerInterface</code>, and pass it to the
<code>initializers</code> array:</p>
<pre class="highlight"><code class="language-php">// In MyInitializer.php

class MyInitializer implements InitializerInterface
{
    public function __invoke(ContainerInterface $container, $instance)
    {
        if (! $instance instanceof EventManagerAwareInterface) {
            return;
        }
        $instance-&gt;setEventManager($container-&gt;get(EventManager::class));
    }
}

// When creating the service manager:

use Interop\Container\ContainerInterface;
use stdClass;
use Laminas\ServiceManager\ServiceManager;

$serviceManager = new ServiceManager([
    'initializers' =&gt; [
        new MyInitializer() // You could also use MyInitializer::class
    ]
]);</code></pre>
<blockquote>
<p>Note that initializers are automatically created when the service manager is
initialized, even if you pass a class name.</p>
</blockquote>
<h3 id="best-practices_2">Best practices</h3>
<p>While convenient, initializer usage is also problematic. They are provided
primarily for backwards compatibility, but we highly discourage their usage.</p>
<p>The primary issues with initializers are:</p>
<ul>
<li>They lead to fragile code. Because the dependency is not injected directly in
  the constructor, it means that the object may be in an "incomplete state". If
  for any reason the initializer is not run (if it was not correctly registered
  for instance), bugs ranging from the subtle to fatal can be introduced.</li>
</ul>
<p>Instead, we encourage you to inject all necessary dependencies via
  the constructor, using factories. If some dependencies use setter or interface
  injection, use delegator factories.</p>
<p>If a given service has too many dependencies, then it may be a sign that you
  need to split this service into smaller, more focused services.</p>
<ul>
<li>They are slow: an initializer is run for EVERY instance you create through
  the service manager. If you have ten initializers or more, this can quickly
  add up!</li>
</ul>
<h2 id="shared">Shared</h2>
<p>By default, a service created is shared. This means that calling the <code>get()</code>
method twice for a given service will return exactly the same service. This is
typically what you want, as it can save a lot of memory and increase
performance:</p>
<pre class="highlight"><code class="language-php">$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class
    ]
]);

$object1 = $serviceManager-&gt;get(stdClass::class);
$object2 = $serviceManager-&gt;get(stdClass::class);

var_dump($object1 === $object2); // prints "true"</code></pre>
<p>However, occasionally you may require discrete instances of a service. To
enable this, you can use the <code>shared</code> key, providing a boolean false value for
your service, as shown below:</p>
<pre class="highlight"><code class="language-php">$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class
    ],
    'shared' =&gt; [
        stdClass::class =&gt; false
    ]
]);

$object1 = $serviceManager-&gt;get(stdClass::class);
$object2 = $serviceManager-&gt;get(stdClass::class);

var_dump($object1 === $object2); // prints "false"</code></pre>
<p>Alternately, you can use the <code>build()</code> method instead of the <code>get()</code> method.
The <code>build()</code> method works exactly the same as the <code>get</code> method, but never
caches the service created, nor uses a previously cached instance for the
service.</p>
<pre class="highlight"><code class="language-php">$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class
    ]
]);

$object1 = $serviceManager-&gt;build(stdClass::class);
$object2 = $serviceManager-&gt;build(stdClass::class);

var_dump($object1 === $object2); // prints "false"</code></pre>
<p>Finally, you could also decide to disable caching by default (even when calling
the <code>get()</code> method), by setting the <code>shared_by_default</code> option to false:</p>
<pre class="highlight"><code class="language-php">$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class
    ],
    'shared_by_default' =&gt; false,
]);

$object1 = $serviceManager-&gt;get(stdClass::class);
$object2 = $serviceManager-&gt;get(stdClass::class);

var_dump($object1 === $object2); // prints "false"</code></pre>
<h2 id="passing-config-to-a-factorydelegator">Passing config to a factory/delegator</h2>
<p>So far, we have covered examples where services are created through factories
(or abstract factories). The factory is able to create the object itself.</p>
<p>Occasionally you may need to pass additional options that act as a "context".
For instance, we could have a <code>StringLengthValidator</code> service registered.
However, this validator can have multiple options, such as <code>min</code> and <code>max</code>.
Because this is dependent on the caller context (or might even be retrieved
from a database, for instance), the factory cannot know what options to give
when constructing the validator.</p>
<p>To solve this issue, the service manager offers a <code>build()</code> method. It works
similarly to the <code>get()</code> method, with two main differences:</p>
<ul>
<li>Services created with the <code>build()</code> method are <strong>never cached</strong>, nor pulled
  from previously cached instances for that service.</li>
<li><code>build()</code> accepts an optional secondary parameter, an array of options.</li>
</ul>
<p>Those options are transferred to all factories, abstract factories, and delegators.
For instance:</p>
<pre class="highlight"><code class="language-php">// In StringLengthValidatorFactory.php

class StringLengthValidatorFactory implements FactoryInterface
{
    public function __invoke(ContainerInterface $container, $requestedName, array $options = [])
    {
        return new StringLengthValidator($options);
    }
}

// When creating the service manager:
$serviceManager = new ServiceManager([
    'factories' =&gt; [
        StringLengthValidator::class =&gt; StringLengthValidatorFactory::class
    ]
]);

// When creating the objects:

$validator1 = $serviceManager-&gt;build(StringLengthValidator::class, ['min' =&gt; 5]);
$validator2 = $serviceManager-&gt;build(StringLengthValidator::class, ['min' =&gt; 15]);</code></pre>
<p>In our previous example, because the <code>StringLengthValidator</code> does not have any
other dependencies other than the <code>$options</code>, we could remove the factory, and
simply map it to the built-in <code>InvokableFactory</code> factory:</p>
<pre class="highlight"><code class="language-php">// When creating the service manager:
$serviceManager = new ServiceManager([
    'factories' =&gt; [
        StringLengthValidator::class =&gt; InvokableFactory::class
    ]
]);

// When creating the objects:

$validator1 = $serviceManager-&gt;build(StringLengthValidator::class, ['min' =&gt; 5]);
$validator2 = $serviceManager-&gt;build(StringLengthValidator::class, ['min' =&gt; 15]);</code></pre>
<p>This works because the <code>InvokableFactory</code> will automatically pass the options
(if any) to the constructor of the created object.</p>
<h2 id="altering-a-service-managers-config">Altering a service manager's config</h2>
<p>Assuming that you have not called <code>$container-&gt;setAllowOverride(false)</code>, you can,
at any time, configure the service manager with new services using any of the
following methods:</p>
<ul>
<li><code>configure()</code>, which accepts the same configuration array as the constructor.</li>
<li><code>setAlias($alias, $target)</code></li>
<li><code>setInvokableClass($name, $class = null)</code>; if no <code>$class</code> is passed, the
  assumption is that <code>$name</code> is the class name.</li>
<li><code>setFactory($name, $factory)</code>, where <code>$factory</code> can be either a callable
  factory or the name of a factory class to use.</li>
<li><code>mapLazyService($name, $class = null)</code>, to map the service name <code>$name</code> to
  <code>$class</code>; if the latter is not provided, <code>$name</code> is used for both sides of
  the map.</li>
<li><code>addAbstractFactory($factory)</code>, where <code>$factory</code> can be either a
  <code>Laminas\ServiceManager\Factory\AbstractFactoryInterface</code> instance or the name
  of a class implementing the interface.</li>
<li><code>addDelegator($name, $factory)</code>, where <code>$factory</code> can be either a callable
  delegator factory, or the name of a delegator factory class to use.</li>
<li><code>addInitializer($initializer)</code>, where <code>$initializer</code> can be either a callable
  initializer, or the name of an initializer class to use.</li>
<li><code>setService($name, $instance)</code></li>
<li><code>setShared($name, $shared)</code>, where <code>$shared</code> is a boolean flag indicating
  whether or not the named service should be shared.</li>
</ul>
<p>As examples:</p>
<pre class="highlight"><code class="language-php">use Laminas\ServiceManager\ServiceManager;

$serviceManager = new ServiceManager([
    'factories' =&gt; [
        stdClass::class =&gt; InvokableFactory::class;
    ]
]);

$serviceManager-&gt;configure([
    'factories' =&gt; [
        DateTime::class =&gt; InvokableFactory::class
    ]
]);

var_dump($newServiceManager-&gt;has(DateTime::class)); // prints true

// Create an alias from 'Date' to 'DateTime'
$serviceManager-&gt;setAlias('Date', DateTime::class);

// Set a factory for the 'Time' service
$serviceManager-&gt;setFactory('Time', function ($container) {
    return $container-&gt;get(DateTime::class);
});

// Map a lazy service named 'localtime' to the class DateTime.
$serviceManager-&gt;mapLazyService('localtime', DateTime::class);

// Add an abstract factory
$serviceManager-&gt;addAbstractFactory(new CustomAbstractFactory());

// Add a delegator factory for the DateTime service
$serviceManager-&gt;addDelegator(DateTime::class, function ($container, $name, $callback) {
    $dateTime = $callback();
    $dateTime-&gt;setTimezone(new DateTimezone('UTC'));
    return $dateTime;
});

// Add an initializer
// Note: don't do this. Use delegator factories instead.
$serviceManager-&gt;addInitializer(function ($service, $instance) {
    if (! $instance instanceof DateTime) {
        return;
    }
    $instance-&gt;setTimezone(new DateTimezone('America/Chicago'));
})

// Explicitly map a service name to an instance.
$serviceManager-&gt;setService('foo', new stdClass);

// Mark the DateTime service as NOT being shared.
$serviceManager-&gt;setShared(DateTime::class, false);</code></pre>




    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../psr-11/">
                    <small class="page-nav__label">Previous</small>
                    <i class="fa fa-chevron-left"></i>
                    PSR-11 Support
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../delegators/">
                    <small class="page-nav__label">Next</small>
                    Delegators
                    <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



                
            </div>
            <div class="col-md-3 col-sm-12 sidebar">
                <div class="donation-banner">
    <a href="https://getlaminas.org/support/">
        <h2>Donate</h2>
        <p>Support Laminas Developers Directly</p>
        <img src="https://funding.communitybridge.org/assets/cb-f-horizontal-white.svg">
    </a>
</div>

                
                    <div class="component-selector">
    
    <h5 class="component-selector__subtitle">Find documentationâ€¦</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">laminas-servicemanager</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            

                
                

                    
                    
                
            

                
                
                    
                        
    <li class="subnavigation__list-item ">
        <a href="../quick-start/" class="subnavigation__link">Quick Start</a>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Reference</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../psr-11/" class="subnavigation__link">PSR-11 Support</a>
    </li>

            
                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Configuring the service manager</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../delegators/" class="subnavigation__link">Delegators</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../lazy-services/" class="subnavigation__link">Lazy services</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../plugin-managers/" class="subnavigation__link">Plugin managers</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../config-abstract-factory/" class="subnavigation__link">Configuration-based Abstract Factory</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../reflection-abstract-factory/" class="subnavigation__link">Reflection-based Abstract Factory</a>
    </li>

            
                
    <li class="subnavigation__list-item ">
        <a href="../console-tools/" class="subnavigation__link">Console Tools</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item">
        <span class="subnavigation__headline">Cookbook</span>
        <ul class="subnavigation__list">
            
                
    <li class="subnavigation__list-item ">
        <a href="../cookbook/factories-vs-abstract-factories/" class="subnavigation__link">Factories vs Abstract Factories</a>
    </li>

            
        </ul>
    </li>

                    
                        
    <li class="subnavigation__list-item ">
        <a href="../migration/" class="subnavigation__link">Migration Guide</a>
    </li>

                    
                
            
        </ul>
    </div>

                    
                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Maintenance Overview <a href="https://getlaminas.org/packages-maintenance-status/">Current maintenance status of Laminas &amp; Mezzio packages</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="row">

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Support</h4>
                        <ul class="support__list">
                            <li class="support__list-item">
                                <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fab fa-slack"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fab fa-github"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://phpc.social/@getlaminas" class="support__link" title="Mastodon"><i class="fab fa-mastodon"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/blog/rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                            </li>
                            <li class="support__list-item">
                                <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                            </li>
                        </ul>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">License</h4>
                        <p>
                            Code licensed under <a
                                href="https://github.com/laminas/laminas-servicemanager/blob/-/LICENSE.md">BSD 3-Clause</a>.
                        </p>
                    </div>

                    
                    <div class="col-md-4">
                        <h4 class="footer__headline">Copyright</h4>
                        <p>
                            <!--Built with love by the Laminas team with the help of our
                            <a href="https://github.com/laminas/laminas-servicemanager/graphs/contributors">contributors</a>.<br>-->
                            &copy; 2024 <a href="https://getlaminas.org/">Laminas Project</a> a Series of LF Projects, LLC.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

    <script>
        let base_url = '../..',
            project  = "components",
            siteName = 'laminas-servicemanager';
    </script>
    <script src="https://docs.laminas.dev/js/scripts.js"></script>
    
        <script src="../../search/main.js"></script>
    

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Search</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search in laminas-servicemanager" id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
        </div>
    </div>
</div>
</body>


</html>
